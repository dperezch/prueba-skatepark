<div class="py-4">
    <h2>Datos del perfil</h2>
    <hr class="w-50" />

    <form id="form-update">
        <div class="form-group row w-50 m-auto">
            <div class="form-group col-12 col-sm-6">
                <label>Email</label>
                <input class="form-control m-auto" disabled value="{{skater.email}}" name="email" />
            </div>
            <div class="form-group col-12 col-sm-6">
                <label>Nombre</label>
                <input class="form-control m-auto" value="{{skater.nombre}}" name="nombre" />
            </div>
            <div class="form-group col-12 col-sm-6">
                <label>Password</label>
                <input type="password" class="form-control m-auto" value="{{skater.password}}" name="password" />
            </div>
            <div class="form-group col-12 col-sm-6">
                <label>Repita la password</label>
                <input type="password" class="form-control m-auto" value="{{skater.password}}" name="password2" />
            </div>
            <div class="form-group col-12 col-sm-6">
                <label>Años de experiencia</label>
                <input class="form-control m-auto" value="{{skater.experiencia}}" name="experiencia" />
            </div>
            <div class="form-group col-12 col-sm-6">
                <label>Especialidad</label>
                <input class="form-control m-auto" value="{{skater.especialidad}}" name="especialidad" />
            </div>
        </div>
        <div class="mb-1">
            <button class="btn btn-primary" name="actualizar">Actualizar</button>
        </div>
        <div>
            <button class="btn btn-danger" name="eliminar">Eliminar cuenta</button>
        </div>
    </form>
</div>

<script>
    console.log("conectado a datos")

    const form = document.querySelector("#form-update")

    form.addEventListener('submit', async (e) => {
        e.preventDefault()

        const {
            email,
            nombre,
            password,
            password2,
            experiencia,
            especialidad,
        } = e.target;

        /* Validar que los campos no esten vacios */
        if (
            email.value.trim() === "" ||
            nombre.value.trim() === "" ||
            password.value.trim() === "" ||
            password2.value.trim() === "" ||
            experiencia.value.trim() === "" ||
            especialidad.value.trim() === "" ||
            foto.files[0] === undefined
        ) {
            alert("Todos los campos son obligatorios");
            return;
        }

        /* Validar que la contraseña tenga al menos 6 caracteres */
        if (password.value.length < 6) {
            alert("La contraseña debe tener al menos 6 carácteres");
            return;
        }

        /* Validar que las contraseñas coincidan */
        if (password.value !== password2.value) {
            alert("Las contraseñas no coinciden");
            return;
        }

        const action = event.submitter.name
        if (action == 'actualizar') {
            const payload = {
                nombre: nombre.value,
                email: email.value,
                password: password.value,
                experiencia: experiencia.value,
                especialidad: especialidad.value,
            }

            const response = await fetch('/skaters', {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(payload)
            })

            const data = await response.json()

            if (!response.ok) {
                alert(`Error: ${data.message}`);
                throw new Error(`HTTP error! status: ${response.status}`);
            } else {
                alert(`El usuario ${data.skater} ha sido actualizado`);
            }
        } else if (action == 'eliminar') {
            const email = email.value
            const response = await fetch('/skaters', {
                method: 'DELETE',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(email)
            })

            const data = await response.json()

            if (response.ok) {
                alert(`${data.message}`)
            } else {
                alert(`Error: ${data.message}`);
                throw new Error(`HTTP error! status: ${response.status}`);
            }
        })

</script>